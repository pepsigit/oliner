<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    
    <meta http-equiv="x-ua-compatible" content="IE=edge"/>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    
    <meta name="author" content="oliner">
    
    
    <meta name="description" content="oliner.cn">
    
    
    <title>
        
        [WebGL]熟悉的三角形和正方形 |
        
        oliner</title>
    
    <link rel="stylesheet" href="/stylesheets/style.min.css">
    
</head>
<body>

<span id="top"> </span>

<aside id="sidebar" >
    <div id="sidebar-overlay">
        <div id="sidebar-inner-wrap">
            <nav id="site-nav">
                <ul class="list-unstyled">
                    
                    
                    <li><a href="/">首页</a></li>
                    
                    
                    
                    <li><a href="/archives">文章</a></li>
                    
                    
                    
                    <li><a href="/tags">标签</a></li>
                    
                    
                    
                    <li><a href="/about">关于</a></li>
                    
                    
                </ul>
            </nav>
            <div id="site-intro">
                <p>
                    
                    oliner
                    
                    
                    <small>.cn</small>
                    
                </p>
                
            </div>
        </div>

        
        <a href="https://unsplash.com" target="_blank" id="image-source" class="align-left hidden-xs"
           data-content="Photo from unsplash.com">i</a>
        
    </div>
</aside>

<main id="main-container">
    <div id="main-inner-wrap">
        <div id="page-content">
            

            <article id="article-post" class="post">
    <div class="post-inner-wrap">
        
        <h1 id="page-title">[WebGL]熟悉的三角形和正方形</h1>

        <ul class="post-meta list-inline">
            <li>时间：<time>2016-06-01</time></li>
            
            <li>
                <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/WebGL/">WebGL</a></li></ul>
            </li>
            
        </ul>
        

        <div class="content">
            <hr>
<p><img src="https://raw.githubusercontent.com/pepsigit/Pictures/master/WebGL/1.png" alt=""></p>
<a id="more"></a>
<p><strong>本人文采不怎么好, 但是还是比较喜欢写注释。</strong></p>
<p><strong>文中避免不了一些错误的存在, 注释也是自己对程序的理解, 望批评并指正.</strong></p>
<p><a href="https://github.com/pepsigit/WebGL" target="_blank" rel="external">首先请下载程序要使用的 OakD库</a></p>
<ul>
<li><strong>在<code>&lt;body&gt;</code>标签中定义我们的程序入口和布局</strong><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">body</span> onload=<span class="string">"WebGLStart();"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;<span class="selector-tag">canvas</span> id=<span class="string">"lesson_1"</span> style=<span class="string">"border: none;"</span> <span class="attribute">width</span>=<span class="string">"500"</span> height=<span class="string">"500"</span>&gt;&lt;/canvas&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>style=&quot;border: none;&quot;</code>: 不要边框</p>
<hr>
<p><strong>接下来在<code>&lt;head&gt;</code>标签中定义脚本</strong></p>
<ul>
<li><strong><code>WelGLStart()</code></strong></li>
</ul>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 入口函数</span></span><br><span class="line">function WebGLStart()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过 Id, 获得已定义的 canvas 元素.</span></span><br><span class="line">    var canvas = document.getElementById(<span class="string">"lesson_1"</span>)<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 WebGL</span></span><br><span class="line">    initWebGL( canvas )<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 Shader</span></span><br><span class="line">    initShader()<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化数据 Buffer</span></span><br><span class="line">    initBuffer()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置清屏颜色</span></span><br><span class="line">    gl.clearColor( <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span> )<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启用深度测试</span></span><br><span class="line">    gl.enable( gl.DEPTH_TEST )<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制场景</span></span><br><span class="line">    drawScene()<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>initWebGL( canvas )</code></strong></li>
</ul>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> gl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 webgl</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initWebGL</span>(<span class="params"> canvas </span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="decorator"><span class="keyword">try</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获得 canvas 的 WebGL 上下文</span></span><br><span class="line">        gl = canvas.getContext(<span class="string">"experimental-webgl"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自定义属性</span></span><br><span class="line">        gl.viewportWidth = canvas.width;</span><br><span class="line">        gl.viewportHeight = canvas.height;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (e)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><strong><code>initShader()</code></strong></li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shaderProgram;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 shader</span></span><br><span class="line">function initShader()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过自定义函数 getShader, 获取 shader 程序</span></span><br><span class="line">    <span class="keyword">var</span> vertexShader    = getShader( <span class="keyword">gl</span>, <span class="string">"shader-vs"</span>);</span><br><span class="line">    <span class="keyword">var</span> fragmentShader  = getShader( <span class="keyword">gl</span>, <span class="string">"shader-fs"</span> );</span><br><span class="line"></span><br><span class="line">    shaderProgram = <span class="keyword">gl</span>.createProgram();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 装载 Shader</span></span><br><span class="line">    <span class="keyword">gl</span>.attachShader( shaderProgram, vertexShader );</span><br><span class="line">    <span class="keyword">gl</span>.attachShader( shaderProgram, fragmentShader );</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">gl</span>.linkProgram( shaderProgram );</span><br><span class="line">    <span class="keyword">gl</span>.useProgram( shaderProgram );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 shader 中顶点位置信息入口</span></span><br><span class="line">    shaderProgram.vertexPositionAttribute = <span class="keyword">gl</span>.getAttribLocation( shaderProgram, <span class="string">"aPosition"</span>);</span><br><span class="line">    <span class="comment">// 启用顶点位置信息入口</span></span><br><span class="line">    <span class="keyword">gl</span>.enableVertexAttribArray( shaderProgram.vertexPositionAttribute );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 shader 中顶点颜色信息入口</span></span><br><span class="line">    shaderProgram.vertexColorAttribute = <span class="keyword">gl</span>.getAttribLocation( shaderProgram, <span class="string">"aColor"</span>);</span><br><span class="line">    <span class="comment">// 启用顶点颜色信息入口</span></span><br><span class="line">    <span class="keyword">gl</span>.enableVertexAttribArray( shaderProgram.vertexColorAttribute );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 shader 中 uniform 属性</span></span><br><span class="line">    shaderProgram.pMatrix   = <span class="keyword">gl</span>.getUniformLocation( shaderProgram, <span class="string">"uPMatrix"</span>);</span><br><span class="line">    shaderProgram.mvMatrix  = <span class="keyword">gl</span>.getUniformLocation( shaderProgram, <span class="string">"uMVMatrix"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>getShader( gl, id )</code></strong></li>
</ul>
<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 shader</span></span><br><span class="line">function getShader( gl, id )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过 id 获得 shader 片段程序</span></span><br><span class="line">    var shaderScript = document.getElementById( id )<span class="comment">;</span></span><br><span class="line">    <span class="keyword">if</span>( !shaderScript )</span><br><span class="line">    &#123;</span><br><span class="line">        console.log( <span class="string">"getShader return null "</span>)<span class="comment">;</span></span><br><span class="line">        <span class="keyword">return</span> null<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var <span class="keyword">str</span> = <span class="string">""</span><span class="comment">;</span></span><br><span class="line">    var k = shaderScript.firstChild<span class="comment">;</span></span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="number">3</span> === k.nodeType )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">str</span> += k.textContent<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        k = k.nextSibling<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var shader<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据 shader 类型, 使用不同的参数创建 shader 实例.</span></span><br><span class="line">    <span class="keyword">if</span>( shaderScript.type == <span class="string">"shader/vs"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 顶点 shader</span></span><br><span class="line">        shader = gl.createShader( gl.VERTEX_SHADER )<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>( shaderScript.type == <span class="string">"shader/fs"</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 片段 shader</span></span><br><span class="line">        shader = gl.createShader( gl.FRAGMENT_SHADER )<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将字符串与 shader 组装</span></span><br><span class="line">    gl.shaderSource( shader, <span class="keyword">str</span> )<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编译 shader</span></span><br><span class="line">    gl.compileShader( shader )<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shader<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>在<code>&lt;head&gt;</code>标签中定义<code>shader</code>程序</strong></p>
<ul>
<li><strong>顶点着色器</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 顶点着色器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"shader-vs"</span> <span class="attr">type</span>=<span class="string">"shader/vs"</span>&gt;</span><span class="actionscript"></span><br><span class="line">    attribute vec3 aPosition;</span><br><span class="line">    attribute vec4 aColor;</span><br><span class="line"></span><br><span class="line">    uniform mat4 uMVMatrix;</span><br><span class="line">    uniform mat4 uPMatrix;</span><br><span class="line"></span><br><span class="line">    varying vec4 vColor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> main( <span class="keyword">void</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        gl_Position = uPMatrix * uMVMatrix * vec4( aPosition, <span class="number">1.0</span> );</span><br><span class="line">        vColor = aColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>片段着色器</strong><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 片段着色器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"shader-fs"</span> <span class="attr">type</span>=<span class="string">"shader/fs"</span>&gt;</span><span class="actionscript"></span><br><span class="line"></span><br><span class="line">    precision mediump float;</span><br><span class="line">    varying vec4 vColor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> main( <span class="keyword">void</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        gl_FragColor = vColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>id=&quot;shader-xx&quot;</code>: 自定义脚本的 id, 类似于您的姓名<br><code>type=&quot;shader/xx&quot;</code>: 脚本的类型, 为了区分是 <code>顶点着色器</code> 还是 <code>片段着色器</code>, 类似于您的性别</p>
<hr>
<ul>
<li><strong><code>initBuffer()</code></strong></li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">// 三角形顶点位置 buffer</span><br><span class="line">var triangBuffer;</span><br><span class="line">// 正方形顶点位置 buffer</span><br><span class="line">var squareBuffer;</span><br><span class="line"></span><br><span class="line">// 三角形顶点颜色 buffer</span><br><span class="line">var triangColorBuffer;</span><br><span class="line">// 正方形顶点颜色 buffer</span><br><span class="line">var squareColorBuffer;</span><br><span class="line"></span><br><span class="line">// 初始化 buffer</span><br><span class="line">function initBuffer()</span><br><span class="line">&#123;</span><br><span class="line">    // 创建顶点 buffer</span><br><span class="line">    triangBuffer = gl.createBuffer();</span><br><span class="line">    </span><br><span class="line">    // 绑定 buffer</span><br><span class="line">    gl.bindBuffer( gl.ARRAY_BUFFER, triangBuffer );</span><br><span class="line">    </span><br><span class="line">    // 顶点位置信息数组</span><br><span class="line">    // 中点在屏幕中间, 位置为 ( 0, 0 )</span><br><span class="line">    var vertices = [ 0.0, 1.0, 0.0, -1.0, -1.0, 0.0, 1.0, -1.0, 0.0 ];</span><br><span class="line">    </span><br><span class="line">    // 将数据传入 buffer</span><br><span class="line">    // <span class="meta">@param</span> target    缓冲区类型: 顶点数据, 索引数据 等.</span><br><span class="line">    // <span class="meta">@param</span> size      缓存数据的大小, 字节数</span><br><span class="line">    // <span class="meta">@param</span> usage     数据分配后, 写入和读取方式</span><br><span class="line">    // 参数和 C++ 版本不太一样</span><br><span class="line">    gl.bufferData( gl.ARRAY_BUFFER, new Float32Array( vertices ), gl.STATIC_DRAW );</span><br><span class="line">    </span><br><span class="line">    // 自定义属性</span><br><span class="line">    // 每个顶点信息大小</span><br><span class="line">    triangBuffer.itemSize = 3;</span><br><span class="line">    </span><br><span class="line">    // 顶点个数</span><br><span class="line">    triangBuffer.numItems = 3;</span><br><span class="line"></span><br><span class="line">    /<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/</span><br><span class="line"></span><br><span class="line">    // 同上</span><br><span class="line">    squareBuffer = gl.createBuffer();</span><br><span class="line">    </span><br><span class="line">    gl.bindBuffer( gl.ARRAY_BUFFER, squareBuffer );</span><br><span class="line">    </span><br><span class="line">    vertices = [1.0, 1.0, 0.0, -1.0, 1.0, 0.0, 1.0, -1.0, 0.0, -1.0, -1.0, 0.0 ];</span><br><span class="line">    </span><br><span class="line">    gl.bufferData( gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW )</span><br><span class="line">    </span><br><span class="line">    squareBuffer.itemSize = 3;</span><br><span class="line">    </span><br><span class="line">    squareBuffer.numItems = 4;</span><br><span class="line"></span><br><span class="line">    /<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/</span><br><span class="line"></span><br><span class="line">    // 创建颜色 buffer</span><br><span class="line">    triangColorBuffer = gl.createBuffer();</span><br><span class="line">    </span><br><span class="line">    gl.bindBuffer( gl.ARRAY_BUFFER, triangColorBuffer );</span><br><span class="line">    </span><br><span class="line">    vertices = [ 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0 ]</span><br><span class="line">    </span><br><span class="line">    gl.bufferData( gl.ARRAY_BUFFER, new Float32Array( vertices), gl.STATIC_DRAW );</span><br><span class="line">    </span><br><span class="line">    triangColorBuffer.numItems = 3;</span><br><span class="line">    </span><br><span class="line">    triangColorBuffer.itemSize = 4;</span><br><span class="line"></span><br><span class="line">    /<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/</span><br><span class="line"></span><br><span class="line">    squareColorBuffer = gl.createBuffer();</span><br><span class="line">    </span><br><span class="line">    gl.bindBuffer( gl.ARRAY_BUFFER, squareColorBuffer );</span><br><span class="line">    </span><br><span class="line">    vertices = [ 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0 ];</span><br><span class="line">    </span><br><span class="line">    gl.bufferData( gl.ARRAY_BUFFER, new Float32Array( vertices ), gl.STATIC_DRAW );</span><br><span class="line">    </span><br><span class="line">    squareColorBuffer.numItems = 4;</span><br><span class="line">    </span><br><span class="line">    squareColorBuffer.itemSize = 4;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><strong><code>drawScene()</code></strong></li>
</ul>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制</span></span><br><span class="line">function drawScene()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置窗口大小</span></span><br><span class="line">    <span class="keyword">gl</span>.viewport( 0, 0, <span class="keyword">gl</span>.viewportWidth, <span class="keyword">gl</span>.viewportHeight );</span><br><span class="line">    <span class="comment">// 清除当前可写的颜色缓冲 和 深度缓冲</span></span><br><span class="line">    <span class="keyword">gl</span>.<span class="keyword">clear</span>( <span class="keyword">gl</span>.COLOR_BUFFER_BIT | <span class="keyword">gl</span>.DEPTH_BUFFER_BIT );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/************************************/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 库函数</span></span><br><span class="line">    <span class="comment">// 投影矩阵, 这是使用的透视投影</span></span><br><span class="line">    <span class="comment">// @param fov   纵向视场角度</span></span><br><span class="line">    <span class="comment">// @param ratio 窗口宽高比</span></span><br><span class="line">    <span class="comment">// @param n1    近-视图裁剪面</span></span><br><span class="line">    <span class="comment">// @param n2    远-视图裁剪面</span></span><br><span class="line">    pMatrix = okMat4Proj(45, <span class="keyword">gl</span>.viewportWidth / <span class="keyword">gl</span>.viewportHeight, 0.1, 100.0);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 模型-视图矩阵 </span></span><br><span class="line">    mvMatrix = okMat4Trans(-1.5, 0.0, -7.0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定将使用的顶点 buffer</span></span><br><span class="line">    <span class="keyword">gl</span>.bindBuffer(<span class="keyword">gl</span>.ARRAY_BUFFER, triangBuffer);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将顶点 buffer 传到顶点片段属性</span></span><br><span class="line">    <span class="comment">// @param index     顶点属性的索引值</span></span><br><span class="line">    <span class="comment">// @param size      每个顶点属性的组件数量: 1, 2, 3, 4. 初始值为 4.</span></span><br><span class="line">    <span class="comment">// @param type      每个组件的数据类型</span></span><br><span class="line">    <span class="comment">// @param bool      读取数据时是否归一化</span></span><br><span class="line">    <span class="comment">// @param stribe    连续顶点属性之间的偏移量 ( 初始值为 0: 紧密排列 )</span></span><br><span class="line">    <span class="comment">// @param pointer   第一个组件在数组的第一个顶点属性中的偏移量 ( 初始值为 0 )</span></span><br><span class="line">    <span class="keyword">gl</span>.vertexAttribPointer(shaderProgram.vertexPositionAttribute, triangBuffer.itemSize, <span class="keyword">gl</span>.FLOAT, false, 0, 0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定将使用的颜色 buffer</span></span><br><span class="line">    <span class="keyword">gl</span>.bindBuffer( <span class="keyword">gl</span>.ARRAY_BUFFER, triangColorBuffer );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将颜色 buffer 传到顶点片段属性</span></span><br><span class="line">    <span class="keyword">gl</span>.vertexAttribPointer( shaderProgram.vertexColorAttribute, triangColorBuffer.itemSize, <span class="keyword">gl</span>.FLOAT, false, 0, 0 );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新矩阵</span></span><br><span class="line">    setMatrixUniforms();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘画</span></span><br><span class="line">    <span class="keyword">gl</span>.drawArrays(<span class="keyword">gl</span>.TRIANGLES, 0, triangBuffer.numItems);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/************************************/</span></span><br><span class="line"></span><br><span class="line">    mvMatrix = okMat4Trans(1.5, 0.0, -7.0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同上</span></span><br><span class="line">    <span class="keyword">gl</span>.bindBuffer(<span class="keyword">gl</span>.ARRAY_BUFFER, squareBuffer);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">gl</span>.vertexAttribPointer(shaderProgram.vertexPositionAttribute, squareBuffer.itemSize, <span class="keyword">gl</span>.FLOAT, false, 0, 0);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">gl</span>.bindBuffer( <span class="keyword">gl</span>.ARRAY_BUFFER, squareColorBuffer );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">gl</span>.vertexAttribPointer( shaderProgram.vertexColorAttribute, squareColorBuffer.itemSize, <span class="keyword">gl</span>.FLOAT, false, 0, 0 );</span><br><span class="line"></span><br><span class="line">    setMatrixUniforms();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">gl</span>.drawArrays(<span class="keyword">gl</span>.TRIANGLE_STRIP, 0, squareBuffer.numItems);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">绘制流程</span><br><span class="line">/<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> 创建 Buffer</span><br><span class="line"> <span class="keyword">*</span> 将 Buffer 绑定到相应的缓冲区</span><br><span class="line"> <span class="keyword">*</span> 将数据传到 Buffer</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span> 重绑定 Buffer</span><br><span class="line"> <span class="keyword">*</span> 获得 Shader 中数据属性</span><br><span class="line"> <span class="keyword">*</span> 启动属性入口</span><br><span class="line"> <span class="keyword">*</span> 将缓冲区数据传入到 Shader 属性</span><br><span class="line"> <span class="keyword">*</span></span><br><span class="line"> <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>/</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>更改矩阵函数<code>setMatrixUniforms()</code></strong></li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mvMatrix;</span><br><span class="line"><span class="keyword">var</span> pMatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setMatrixUniforms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 将矩阵信息传入到 shader 中的 uniform 变量</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// @param location  uniform 变量位置</span></span><br><span class="line">    <span class="comment">// @param bool      是否需要转置矩阵</span></span><br><span class="line">    <span class="comment">// @param value     信息指针( 虽然脚本没有指针的概念 )</span></span><br><span class="line">    gl.uniformMatrix4fv(shaderProgram.pMatrix, <span class="literal">false</span>, pMatrix.toArray());</span><br><span class="line">    gl.uniformMatrix4fv(shaderProgram.mvMatrix, <span class="literal">false</span>, mvMatrix.toArray());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>在<code>&lt;head&gt;</code>标签中导入需要的函数库</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"Oak3D_v_0_5.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/pepsigit/WebGL/blob/master/lesson_1.html" target="_blank" rel="external">源码</a></p>

        </div>
    </div>
</article>

<nav id="article-nav">
    <ul class="list-unstyled">
        <li>
            
            <a href="/2016/06/01/旋转/" class="prev" data-title="[WebGL]旋转"></a>
            
        </li>
        <li>
            
        </li>
    </ul>
</nav>


        </div>
        <footer id="mastfoot">
            <p>
                Powered by <a href="http://www.hexo.io" target="_blank">Hexo</a> 
            </p>

            
            <p>Since 2016</p>
            
        </footer>
    </div>
</main>

<script>
    var sidebar = document.getElementById('sidebar');
    if (!sidebar.getAttribute('style')) {
        sidebar.setAttribute('style', 'background-image: url(/images/sidebar-bg/' + Math.floor(Math.random() * parseInt('16')) + '.jpg)');
    }
</script>

</body>
</html>
